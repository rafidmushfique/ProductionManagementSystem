@model LILI_FPMS.Models.TblRebRequisition

<!-- Modal placeholder -->
<div id="modal-placeholder"></div>



<!-- Content Header (Page header) -->
<section class="content-header">
    @*<h1>
            Requisition
        </h1>*@
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Requisition</li>
        <li class="active">Add Requisition</li>
    </ol>
</section>
<!-- Main content -->
<section class="content container-fluid">
    <!-- Horizontal Form -->
    <div class="box box-info" style="border:1px solid; border-color:cadetblue; padding:10px">
        @*<div class="box-header with-border">
                <h3 class="box-title">Add Requisition</h3>
        </div>*@
        <!-- /.box-header -->
        <!-- form start -->
        <form class="form-horizontal" asp-controller="RebRequisition" method="post" asp-action="CreateRequisition">
            @*<div asp-validation-summary="ModelOnly" class="text-danger">
                    <span>Please correct the following errors</span>
                </div>*@



            @*@if (ViewData["Error"] != null)
                {
                    <div class="red">
                        <p><strong>Error:</strong> @ViewData["Error"].ToString()</p>
                    </div>
                }
                @if (TempData["Success"] != null)
                {
                    <div class="green">
                        <p><strong>Success:</strong> @TempData["Success"].ToString()</p>
                    </div>
                }*@





            <div class="card-body">
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Requisition No.</label>
                    <div class="col-sm-4">
                        <input type="text" asp-for="RequisitionNo" class="form-control" placeholder="Requisition No." readonly="readonly">
                        <span asp-validation-for="RequisitionNo"></span>
                    </div>

                    <label asp-for="RequisitionDate" class="col-sm-2 control-label"></label>
                    <div class='col-sm-3 input-group date' id='RequisitionDate' style="padding-left:15px;">
                        <input asp-for="RequisitionDate" type='text' class="form-control" />
                        <span asp-validation-for="RequisitionDate" class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Batch No.</label>
                    <div class="col-sm-4">
                        <input type="text" asp-for="BatchNo" class="form-control" placeholder="Batch No.">
                        <span asp-validation-for="BatchNo"></span>
                    </div>

                    @*<label for="inputEmail3" class="col-sm-2 control-label">Number of Batch</label>*@
                    <label for="inputEmail3" class="col-sm-2 control-label">Requisition QTY</label>
                    <div class="col-sm-4">
                        <input type="text" asp-for="NumberOfBatch" class="form-control" placeholder="Number of Batch">
                        <span asp-validation-for="NumberOfBatch"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Product Code</label>
                    <div class="col-sm-2">
                        <input type="text" asp-for="ProductCode" class="form-control" placeholder="Product Code" readonly="readonly">
                        <span asp-validation-for="ProductCode"></span>
                    </div>

                    <div class="col-sm-2">
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-mini btn-primary" data-toggle="ajax-modal" data-target="#add-product" data-url="@Url.Action("SearchProduct")">
                            Search Product
                        </button>
                    </div>

                    <label for="inputEmail3" class="col-sm-2 control-label">Product Name</label>
                    <div class="col-sm-4">
                        <input type="text" asp-for="ProductName" class="form-control" placeholder="Product Name" readonly="readonly">
                        <span asp-validation-for="ProductName"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Standard Output</label>
                    <div class="col-sm-4">
                        <input type="text" asp-for="StandardOutput" class="form-control" readonly="readonly">
                    </div>

                    <label for="inputEmail3" class="col-sm-2 control-label">Batch Size</label>
                    <div class="col-sm-4">
                        <input type="text" asp-for="BatchSize" class="form-control" readonly="readonly">
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="Comments" class="col-sm-2 control-label"></label>
                    <div class="col-sm-10">
                        <input type="text" asp-for="Comments" class="form-control" placeholder="Comments">
                    </div>
                </div>


                



                <div style="border:1px solid #e5dbff; padding:10px;">
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Material Code</label>
                        <div class="col-sm-2">
                            <input type="text" Id="MaterialCodeSearch" class="form-control" placeholder="Material Code" readonly>
                        </div>
                        <div class="col-sm-2 controls">
                            <button type="button" class="btn btn-info" data-toggle="ajax-modal" data-target="#add-material-search" data-url="@Url.Action("AddMaterialSearch")">
                                <span class="glyphicon glyphicon-search"></span>
                            </button>
                        </div>

                        <label for="inputEmail3" class="col-sm-2 control-label">Material Name</label>
                        <div class="col-sm-4">
                            <input type="text" Id="MaterialNameSearch" class="form-control" placeholder="Material Name" readonly>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Unit</label>
                        <div class="col-sm-4">
                            <input type="text" Id="MaterialUnit" class="form-control" placeholder="Unit">
                        </div>

                        <label for="inputEmail3" class="col-sm-2 control-label">Required Qty</label>
                        <div class="col-sm-4">
                            <input type="text" Id="RequiredQty" class="form-control" placeholder="Required Qty" onkeypress='return isNumberKey(event)'>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label"></label>
                        <div class="col-sm-10">
                            <a class="btn btn-primary" onclick="addNewRowToMaterialGrid()">Add Material to grid</a>
                        </div>
                    </div>
                    <div class="card-body">
                        <div style="border-radius:30px; border:0px solid #ccc; min-width:30%;  overflow:auto;">
                            <table id="htReqMaterialDetail" class="table table-bordered table-striped">
                                <thead>
                                    <tr>
                                        <th style="width:10%; !important">Material Code</th>
                                        <th style="width:30%;">Material Name</th>
                                        <th style="width:10%;">Unit</th>
                                        <th style="width:10%;">Standard Recipe Quantity</th>
                                        <th style="width:10%;">Floor Stock</th>
                                        <th style="width:10%;">Available Stock</th>
                                        <th style="width:10%;">Required Quantity</th>
                                        
                                        <th style="width:5%;">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="tblReqBOMDtl" class="js_tblBOMDtl_body">
                                    @foreach (var item in Model.TblRequisitionDetail)
                                    {
                                        int i = 0; //To make unique Id
                                        <tr>
                                            <td>@Html.EditorFor(modelItem => item.MaterialCode)</td>
                                            <td>@Html.DisplayFor(modelItem => item.MaterialName)</td>
                                            <td>@Html.DisplayFor(modelItem => item.Unit)</td>
                                            <td style="text-align:right; width:70px;">@Html.EditorFor(modelItem => item.StandardRecipeQty)</td>
                                            <td style="text-align:right; width:70px;">@Html.EditorFor(modelItem => item.FloorStock)</td>
                                            <td style="text-align:right; width:70px;">@Html.EditorFor(modelItem => item.AvailableStock)</td>
                                            <td style="text-align:right; width:70px;">@Html.EditorFor(modelItem => item.RequiredQty)</td>
                                            
                                            <td><a href="" onclick="Delete('@item.Id')">Delete</a></td>
                                        </tr>
                                        i++;
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>


            <!-- /.card-body -->
            <div class="box-footer">

                <a class="btn btn-mini btn-primary" href='@Url.Content("/RebRequisition/Index")'>Cancel</a>
                <button type="submit" class="btn btn-info pull-right">Create</button>

            </div>
            <!-- /.box-footer -->
        </form>
    </div>
    <!-- /.box -->
</section>




<script type="text/javascript">

    function addNewRowToMaterialGrid() {

        var MaterialCode = $("#MaterialCodeSearch").val();
        var MaterialName = $("#MaterialNameSearch").val();
        var Unit = $("#MaterialUnit").val();
        var StandardRecipeQty = 0;
        var FloorStock = 0;
        var AvailableStock = 0;
        var RequiredQty = $("#RequiredQty").val();

            @{
                Model.TblRequisitionDetail.Add(new TblRequisitionDetail());
            }

        var index = $("#tblReqBOMDtl").children("tr").length;

        var indexCell = "<td style='display:none'><input name='TblRequisitionDetail.Index' type='hidden' value='" + index + "' /></td>";
        var idCell = "<td style='display:none'> <input id='TblRequisitionDetail_" + index + "_Id' name='TblRequisitionDetail[" + index + "].Id' type='text' value='" + parseInt(index+1) +  "' /></td>";
        var MaterialCodeCell = "<td><input style='width:100%' class='form-control nothing' readonly id='TblRequisitionDetail_" + index + "_MaterialCode' name='TblRequisitionDetail[" + index + "].MaterialCode' type='text' value='" + MaterialCode +"' /></td>";
        var MaterialNameCell = "<td><input style='width:100%' class='form-control nothing' readonly id='TblRequisitionDetail_" + index + "_MaterialName' name='TblRequisitionDetail[" + index + "].MaterialName' type='text' value='" + MaterialName + "' /></td>";
        var MaterialUnitCell = "<td><input style='width:100%' class='form-control nothing' readonly id='TblRequisitionDetail_" + index + "_Unit' name='TblRequisitionDetail[" + index + "].Unit' type='text' value='" + Unit + "' /></td>";
        var StandardRecipeQtyCell = "<td><input style='text-align:right; width:100%' id='TblRequisitionDetail_" + index + "_StandardRecipeQty' name='TblRequisitionDetail[" + index + "].StandardRecipeQty' type='text' value='" + StandardRecipeQty + "' /></td>";
        var FloorStockCell = "<td><input style='text-align:right; width:100%' id='TblRequisitionDetail_" + index + "_FloorStock' name='TblRequisitionDetail[" + index + "].FloorStock' type='text' value='" + FloorStock + "' /></td>";
        var AvailableStockCell = "<td><input style='text-align:right; width:100%' id='TblRequisitionDetail_" + index + "_AvailableStock' name='TblRequisitionDetail[" + index + "].AvailableStock' type='text' value='" + AvailableStock + "' /></td>";
        var RequiredQtyCell = "<td><input style='text-align:right; width:100%' id='TblRequisitionDetail_" + index + "_RequiredQty' name='TblRequisitionDetail[" + index + "].RequiredQty' type='text' value='" + RequiredQty +"' /></td>";
        
        var removeCell = "<td><input id='addRow' type='button' value='Remove' onclick='removeRow(" + index + ");' /></td>";

        var newRow = "<tr id='trtbReqBOMDtl" + index + "'>" + indexCell + MaterialCodeCell + MaterialNameCell + MaterialUnitCell + StandardRecipeQtyCell + FloorStockCell + AvailableStockCell + RequiredQtyCell + removeCell + "</tr>";
        $("#tblReqBOMDtl").append(newRow);

        $("#MaterialCodeSearch").val('');
        $("#MaterialNameSearch").val('');
        $("#MaterialUnit").val('');
        $("#StandardRecipeQty").val('');
        $("#FloorStock").val('');
        $("#RequiredQty").val('');
    }

    function removeRow(id) {
        var controlToBeRemoved = "#trtbReqBOMDtl" + id;
        //alert(controlToBeRemoved);
        $(controlToBeRemoved).remove();
    }

    function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode
        if (charCode > 31 && (charCode != 46 && (charCode < 48 || charCode > 57)))
            return false;
        return true;
    }

</script>


